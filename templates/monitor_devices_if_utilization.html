{% extends 'base.html' %}
{% block title %}
    乾頤堂监控设备
{% endblock title %}

{% block js %}
    <!-- 加载Chart.js的JS文件 -->
    <!-- 最新的Chart JS 文件 https://cdnjs.com/libraries/Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <!-- 加载本项目创建的chart_json_functions.js的JS文件-->
    {% load static %}
    <script src="{% static "js/chart_functions.js" %}"></script>
    <!-- 加载ajax的JS文件-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
{% endblock js %}

{% block body %}

<div class="container-fluid">
<br><h2 style="color: #666666">乾颐堂设备监控接口利用率</h2><br>
<div class="card text-center">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs">
      {% for device in devices_list %}
          {% if device == current %}
          <li class="nav-item">
            <a class="nav-link active" href="/monitordevice/if_utilization/{{ device }}/">{{ device }}</a>
          </li>
          {% else %}
          <li class="nav-item">
            <a class="nav-link" href="/monitordevice/if_utilization/{{ device }}/">{{ device }}</a>
          </li>
          {% endif %}
      {% endfor %}
    </ul>
  </div>
  <div class="card-body">
    <h5 class="card-title", style="color: #9d9d9d"><strong>监控接口利用率</strong></h5>
    <select id="ifname">
     {% for ifname in if_list %}
         {% if forloop.counter == 1 %}
            <option value={{ ifname }} selected="selected">{{ ifname }}</option>
         {% else %}
            <option value={{ ifname }}>{{ ifname }}</option>
         {% endif %}
     {% endfor %}
    </select>
    <select id="direction">
     <option value="rx" selected="selected">入方向</option>
     <option value="tx">出方向</option>
    </select>
    <!-- 点击按钮,调用json_chart1函数(位于chart_json_functions.js),从URL获取数据,并绘制图表-->
    <button onClick="if_utilization_chart();">查询</button>
      <div class='row'>
          <div class='col col-md-2'>
          </div>
          <div class='col col-md-8'>
            <canvas id='chart'></canvas>
          </div>
          <div class='col col-md-2'>
          </div>
      </div>


  </div>
</div>
</div>
<script type="text/javascript" language="javascript">
    function if_utilization_chart() {
        let e = document.getElementById("ifname");
        let ifname = e.options[e.selectedIndex].value;

        let i = document.getElementById("direction");
        let direction = i.options[i.selectedIndex].value;
        let url = "/monitordevice/if_utilization/{{ current }}/" + ifname + "/" + direction
        $.getJSON(url, function (data) {//请求URL的JSON,得到数据data,下面是对data的处理
            chart_line('chart', data.ifname+" "+direction+" 利用率(单位%)", data.utilization_time, data.utilization_data, ['#007bff', '#28a745', '#333333', '#c3e6cb', '#dc3545', '#6c757d'])
        });
    }
</script>

{% endblock body %}
